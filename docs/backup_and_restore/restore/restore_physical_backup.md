---
sidebar_position: 2
---

# 恢复物理备份数据

在数据库发生误操作或故障时，您可以通过 NineData 的备份与恢复服务将备份数据恢复到数据库。

### 前提条件

- 已经完成一次完整的备份。如何备份数据，请参见请参见[执行物理备份](../backup/physical_backup.md)。
- 已经通过**网关**的连接方式将需要恢复的数据库添加到 NineData。更多信息，请参见[添加数据源](../../configuration/datasource.md)。
- 需要恢复的数据源为自建的 SQL Server 数据库。

### 注意事项

恢复的目标数据源版本必须大于或等于备份数据的数据源版本。例如，SQL Server 2019 的备份数据不支持恢复到 SQL Server 2017 数据源。

### 操作步骤

1. 登录 [NineData 控制台](https://console.ninedata.cloud)。

2. 在左侧导航栏单击**备份与恢复**>**数据恢复**。

   :::tip

   您也可以单击**备份与恢复**>**备份集**，在**全量备份集**页签下，找到目标已完成备份的备份集 ID，单击其右侧**操作**列下的**恢复数据**。

   :::

3. 在**选择恢复方式**页签，根据下表进行配置，并单击**下一步**。

   | 参数<div style={{width:'50pt'}}></div> | 说明                                                         |
   | -------------------------------------- | ------------------------------------------------------------ |
   | **任务名称**                           | 输入恢复任务的名称，为了方便后续查找和管理，请尽量使用有意义的名称。最多支持 64 个字符。 |
   | **源数据源**                           | 备份的对象，您可以通过选择**源数据源**快速找到**备份任务**。 |
   | **备份任务**                           | 备份数据源时创建的备份任务，包含了恢复所需的所有数据。       |
   | **恢复方式**                           | 支持如下恢复方式：<ul><li>**按时间点恢复**：该方式基于全量备份数据和日志，可恢复全量数据和后续产生的增量数据。具体可恢复时间段请参见控制台。</li><li>**备份集**：该方式仅基于全量备份数据，支持恢复到全量备份完成的时间点，不包含增量数据。</li></ul> |
   | **恢复时间点**                         | **恢复方式**为**按时间点恢复**时可配置，选择将数据恢复到哪个时间点。支持分钟级 RPO，既可恢复备份开始至当前时间点前几分钟到 30 分钟之间的任意时间点的数据。 |
   | **备份集**                             | **恢复方式**为**备份集**时可配置，选择全量备份集，该选项不包含增量数据。 |
   | **目标数据源**                         | 恢复的对象，选择将备份数据恢复到哪个数据源。                 |
   | **网关**                               | 物理恢复会直接将文件恢复到目标数据源中，因此目标数据源需要配置网关。如果您在添加数据源时已经通过网关接入，此处已经自动配置完成。如果您未通过网关接入数据源，请参见如下步骤：<ol><li>将数据源所在主机[添加到网关](../../configuration/gateway.md)。</li><li>将数据源通过网关接入。更多信息，请参见[添加数据源](../../configuration/datasource.md)。</li></ol> |
   
4. 在**恢复对象**页签，根据下表进行配置，并单击**下一步**。

   | 参数<div style={{width:'50pt'}}></div> | 说明                                                         |
   | -------------------------------------- | ------------------------------------------------------------ |
   | **恢复对象**                           | 确认需要恢复的内容，您可以选择**所有备份**恢复所有数据，也可以选择**自定义对象**，自行选择需要恢复的数据。 |
   | **数据库已存在处理策略**               | <ul><li>**覆盖现有数据库（WITH REPLACE）**：如果目标库中有同名库，则使用备份文件中的数据库直接覆盖。</li><li>**报错并退出**：如果目标库中有同名库，则在预检查时报错。</li></ul> |

5. 在**配置映射对象**页签，配置恢复到目标数据源之后的库名，单击**保存并预检查**。

6. 在**预检查**页签，等待系统完成预检查，预检查通过后，单击**启动任务**。

   :::tip

   - 如果预检查未通过，需要单击目标检查项右侧**操作**列的**详情**，排查失败的原因，手动修复后重新执行预检查，直到通过。
- **检查结果**为**警告**的检查项，可视具体情况修复或忽略。
   - 如果您不想立即开启任务，可以单击**保存任务，返回列表**，将当前恢复任务保存到**恢复任务**列表中，避免后期从头配置。

   :::

7. 在**启动任务**页面，提示**启动成功**。单击**查看详情**查看恢复任务的执行情况；单击**返回列表**可以返回**恢复任务**列表。

### 相关文档

- [数据备份简介](../intro_back.md)
- [执行物理备份](../backup/physical_backup.md)
- [执行逻辑备份](../backup/logical_backup.md)
- [恢复逻辑备份数据](restore_logical_backup.md)
- [查看备份集](../view_backup_sets.md)
- [查询备份数据](../backup_data_query.md)