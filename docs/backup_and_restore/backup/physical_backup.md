---
sidebar_position: 3
---

# 备份数据（物理备份）

NineData 数据备份服务物理备份支持对数据源执行全量备份、增量备份操作。

### 前提条件

- 数据源为自建的 SQL Server 数据库，版本为 2019、2017、2016、2014、2012、2008R2。

- 已经通过**网关**的连接方式将自建库添加到 NineData。更多信息，请参见[添加数据源](../../configuration/datasource.md)。

  :::tip

  网关必须部署在需要进行物理备份的自建库所在主机上。

  :::

### 操作步骤

1. 登录 [NineData 控制台](https://console.ninedata.cloud)。

2. 在左侧导航栏单击**备份与恢复**>**数据备份**。

3. 在**备份任务**页面，单击右上角的**创建备份**。

4. 在**数据源与目标**页面，按照下表进行配置，并单击**下一步**。

   | 参数<div style={{width:'50pt'}}></div> | 说明                                                         |
   | -------------------------------------- | ------------------------------------------------------------ |
   | **任务名称**                           | 输入备份任务的名称，为了方便后续查找和管理，请尽量使用有意义的名称。最多支持 64 个字符。 |
   | **数据源**                             | 选择您希望进行备份的数据源，如果您刚添加了新的数据源，可以单击右侧的**刷新**获取最新的数据源列表。 |
   | **备份方式**（仅 SQL Server 支持）       | 选择**物理备份**。<ul><li>**逻辑备份**：以数据库对象（例如表、索引等）为备份对象的备份方式。支持全量备份、增量备份、结构备份等多种备份类型。</li><li>**物理备份**：以数据库中的文件为备份对象的备份方式。</li></ul> |
   | **网关**                               | 物理备份会直接对数据源中的文件进行备份，因此需要配置网关。如果您在添加数据源时已经通过网关接入，此处已经自动配置完成。如果您未通过网关接入数据源，请参见如下步骤：<ol><li>将数据源所在主机[添加到网关](../../configuration/gateway.md)。</li><li>将数据源通过网关接入。更多信息，请参见[添加数据源](../../configuration/datasource.md)。</li></ol><!--选择数据源所在主机的网关。由于物理备份是直接对数据库中的文件进行备份，而读取数据源所在主机中的文件需要在该主机中安装网关。如果您未安装，请单击**安装网关**，并根据右侧弹出页面中的安装步骤在数据源所在主机中安装网关。安装完成后，**网关连接示意图**状态显示**本地网关连接成功**。--> |
   | **备份类型**                           | 支持如下备份类型：<ul><li>**数据备份+日志备份**：备份数据中将包含全量和增量数据。</li><li>**数据备份**：备份数据中包含仅包含全量数据。</li></ul><br />NineData 支持 SQL Server 的 Copy-Only 功能，您可以勾选**仅复制备份 Copy-Only** 前面的复选框开启。关于该功能的更多信息，请参见[微软官方文档](https://learn.microsoft.com/en-us/sql/relational-databases/backup-restore/copy-only-backups-sql-server)。 |
   | **存储目标**                           | 选择备份数据的存储位置，请根据数据源所在位置就近选择。NineData 提供多个云厂商以及多个地域，支持**阿里云**、**腾讯云**、**华为云**和 **AWS**，支持的地域请参见控制台。 |

5. 在**备份对象与周期**页面，按照下表进行配置，并单击**保存并预检查**。

   | 参数<div style={{width:'50pt'}}></div> | 说明                                                         |
   | -------------------------------------- | ------------------------------------------------------------ |
   | **备份对象**                           | 需要备份的内容，支持全选和自定义。<ul><li>**所有数据库及对象**：备份该数据源中所有的数据库以及对象。</li><li>**自定义对象**：手动选择需要备份的数据库及对象。</li></ul><br /> |
   | **备份策略**                           | <ul><li>**时区**：选择您所在地域的时区，系统会根据您所选择时区的时间点启动备份，默认为北京时区。</li><li>**备份频率**：选择多长时间备份一次，可选周一到周日、00:00 到 23:59 的任意时间段。也可以勾选**每天**，每天备份一次。</li><li>**日志备份频率**：默认为 **30 分钟**，既每 30 分钟发起一次日志文件的备份。</li><li>**保存时间**：备份文件（包含备份文件和日志文件）的保存时长，到期后会被自动删除。可选时间为 **7 天、30 天、60 天、90 天、半年、1 年、2 年**，默认为**7 天**。</li></ul> |

6. 在**预检查**页面，系统会自动进行兼容性检查，检查结果会显示在页面上，全部成功后单击**启动任务**。

   :::tip

   如果检查未通过，您需要对未通过的检查项进行手动排查，完成后再重新根据此操作步骤配置备份任务。

   :::

7. 在**启动任务**页面提示**启动成功**后，数据备份服务会在您设定的备份周期自动启动备份。您也可以单击**立即备份**立即进行一次备份。

   :::tip

   您也可以按照下列两种方式立即备份数据：

   - 在左侧导航栏单击**数据备份**，并在**备份任务**页面单击该任务右侧**操作**列的**立即备份**来启动备份。
   - 在左侧导航栏单击**数据备份**，在**备份任务**页面单击目标任务ID，并在**备份详情**页单击右上角的**立即备份**。

   :::

8. 在左侧导航栏单击**数据备份**，在**备份任务**页面单击目标**任务 ID**，即可查看备份任务的详细状态。

### 相关文档

- [数据备份简介](../intro_back.md)
- [执行逻辑备份](logical_backup.md)
- [恢复逻辑备份数据](../restore/restore_logical_backup.md)
- [恢复物理备份数据](../restore/restore_physical_backup.md)
- [查看备份集](../view_backup_sets.md)
- [查询备份数据](../backup_data_query.md)

