---
sidebar_position: 3
---



# SQL任务

SQL任务是对数据库发起SQL操作的任务，主要包括DDL（数据库定义语言）、DML（数据库操纵语言）等SQL语句。本文介绍如何使用SQL任务。

### 功能介绍

为保障数据安全，对目标数据源没有写权限的用户无法对该数据源的内容发起变更，在有变更需求的情况下，可以通过提交SQL任务工单实现。NineData提供的SQL任务功能具有全周期的安全管控，包括提交、审批、执行、回滚等步骤。

### 前提条件

* 已创建或加入组织。更多信息，请参见[管理组织](../account/manage_organization.md)。
* NineData控制台处于组织模式。如何从个人模式切换组织模式，请参见[切换到组织](../account/manage_organization.md#switch)。
* 当前用户具有访问SQL任务模块的权限。更多信息，请参见[预置角色权限列表](../account/manage_role.md#role_list)。

### 提交SQL变更任务

1. 登录[NineData控制台](https://console.9z.cloud)。

2. 在左侧导航栏，单击**SQL开发**>**SQL任务**。

   > 如果未找到**SQL任务**，请确认您的控制台处于组织模式。如何从个人模式切换组织模式，请参见[切换到组织](../account/manage_organization.md#switch)。

3. 在**SQL任务**页面，单击右上角的**创建SQL任务**。

4. 在**创建SQL任务**页面，根据下表配置工单。

   | 参数<div style={{width:'50pt'}}></div> | 说明                                                         |
   | -------------------------------------- | ------------------------------------------------------------ |
   | **任务名称**                           | 输入SQL任务的名称，该名称通常包含了SQL语句的执行目的，为减少沟通成本，请尽量使用有意义的名称。最多支持64个字符。 |
   | **数据源**                             | 目标需变更数据库所在的数据源。                               |
   | **数据库**                             | 需要执行SQL变更的数据库。                                    |
   | **发布人**                             | 当前SQL任务单的审批人兼审批通过后的SQL语句执行人。<br />**说明**：用户列表中仅显示对当前数据源拥有读写权限的用户。 |
   | **备注**（可选）                       | 针对当前SQL任务未尽事项的说明，例如执行任务的原因，期望执行时间等。 |
   | **提交方式**                           | 输入需要执行的SQL语句或上传包含SQL语句的文件。<ul><li>**SQL文本**：直接在文本框中输入需要执行的SQL语句。</li><li>**上传SQL文件**：单击**上传文件**，并选择包含需执行SQL语句的文件，单击**打开**。<br />**说明**：上传完成后，把鼠标移动到文件名处，可在文件名右侧选择![review](./image/review.png)（预览文件）或![delete](./image/delete.png)（删除文件)。</li></ul> |

5. 单击**预检查**，系统会提前对SQL语句进行检查，排除语法错误等无法执行的情况。如果SQL语句有问题，会在下方出现提示，单击提示中的**查看详情**即可查看具体的错误信息，方便您进行定位和修改。

6. **预检查**通过后，单击**保存编辑**，即可发起SQL任务。此时页面自动跳转至**SQL任务**页面，您可以查看SQL任务列表或对SQL任务进行管理操作。

   > **说明**：对于自身为**提交人**的任务，您还可以在**SQL任务**页面做如下操作：
   >
   > * **复制任务**：单击该任务右侧**操作**列的![more](./image/more.png)>**复制任务**，复制一个一模一样的任务单。
   > * **关闭**：单击该任务右侧**操作**列的![more](./image/more.png)>**关闭**，关闭目标任务单。关闭后，如果该SQL任务还未执行，则不会再被执行。
   > * **删除**：单击该任务右侧**操作**列的![more](./image/more.png)>**删除**，删除目标任务单。

### <span id="revoke">撤回SQL任务</span>

SQL任务的状态处于**待处理**时，您可以撤回该SQL任务的申请，撤回后，任务不再执行，您可以重新编辑该任务单再次提交。

**前提条件**

- SQL任务的状态为**待处理**。
- 您是目标SQL任务的**提交人**。

**操作步骤**

1. 登录[NineData控制台](https://console.9z.cloud)。

2. 在左侧导航栏，单击**SQL开发**>**SQL任务**。

   > 如果未找到**SQL任务**，请确认您的控制台处于组织模式。如何从个人模式切换组织模式，请参见[切换到组织](../account/manage_organization.md#switch)。

3. 在**SQL任务**页面，找到目标SQL任务，单击任务ID或任务右侧**操作**列的**详情**。在任务详情页右上角单击**撤回**。

   > 您也可以单击任务右侧**操作**列的![more](./image/more.png)>**撤回**。

4. 在弹出的确认窗口中，单击**撤回**或**撤回并编辑**。

   * **撤回**：页面自动跳转该SQL任务的详情页面，您可以单击页面右上角的**编辑**，或退回**SQL任务**列表找到该SQL任务，单击右侧**操作**列下的**编辑**，重新编辑任务单。
   * **撤回并编辑**：页面自动跳转至SQL任务的编辑页面。

### 审批SQL任务

**前提条件**

- SQL任务的状态为**待处理**。
- 您是目标SQL任务的**发布人**。

**操作步骤**

1. 登录[NineData控制台](https://console.9z.cloud)。

2. 在左侧导航栏，单击**SQL开发**>**SQL任务**。

   > 如果未找到**SQL任务**，请确认您的控制台处于组织模式。如何从个人模式切换组织模式，请参见[切换到组织](../account/manage_organization.md#switch)。

3. 在**SQL任务**页面，找到目标SQL任务，单击任务ID或任务右侧**操作**列的**详情**。

4. 在**任务详情**页面，审批**SQL详情**中的内容，根据实际情况选择**转交**、**执行**或**驳回**。

   | <div style={{width:'25pt'}}></div>操作 | 说明                                                         |
   | -------------------------------------- | ------------------------------------------------------------ |
   | **转交**                               | 将任务单转交给其他用户审批。                                 |
   | **执行**                               | 批准申请，并根据业务需求选择**立即执行**、**定时执行**或**手动执行**。<ul><li>**立即执行**：马上执行SQL语句。</li><li>**定时执行**：选择一个时间段执行。您可以选中**若执行失败，发送告警**，并选择**告警方式**和**接收人**，当SQL执行失败时，告警接收人会收到提醒信息。<br /></li><li>**手动执行**：手动执行SQL任务单中的SQL，并单击**已执行，标记成功**。您也可以单击**前往SQL窗口执行**手动执行该SQL。</li></ul> |
   | **驳回**                               | 驳回请求，不执行该SQL任务。单击**驳回**后，您还需要输入**驳回原因**，并单击**确定**。<br />如果您批准了SQL任务，并选择了**定时执行**，则还可以在该任务状态为**待执行**的情况下驳回该SQL任务。操作步骤：<ol><li>在**SQL任务**页面，单击该任务右侧**操作**列下的**撤销执行**，或在该任务的详情页的右上角单击**撤销执行**。</li><li>输入**驳回原因**，单击**确定**。</li></ol><br />**说明**：**提交人**和**发布人**为同一人的情况下无法**驳回**，仅支持[撤回SQL任务](#revoke)。 |

